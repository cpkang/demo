<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目中的一些知识点 | 对二甲苯</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/demo/assets/img/favicon.png">
    <meta name="description" content="博客的描述">
    
    <link rel="preload" href="/demo/assets/css/0.styles.e35f60a0.css" as="style"><link rel="preload" href="/demo/assets/js/app.717f180f.js" as="script"><link rel="preload" href="/demo/assets/js/2.59a3a8ac.js" as="script"><link rel="preload" href="/demo/assets/js/18.3836db53.js" as="script"><link rel="prefetch" href="/demo/assets/js/10.54c2ea74.js"><link rel="prefetch" href="/demo/assets/js/11.c7016a27.js"><link rel="prefetch" href="/demo/assets/js/12.aa622410.js"><link rel="prefetch" href="/demo/assets/js/13.a23b9a76.js"><link rel="prefetch" href="/demo/assets/js/14.d450f03b.js"><link rel="prefetch" href="/demo/assets/js/15.df837263.js"><link rel="prefetch" href="/demo/assets/js/16.7e84f14d.js"><link rel="prefetch" href="/demo/assets/js/17.3a47b2df.js"><link rel="prefetch" href="/demo/assets/js/3.c0795054.js"><link rel="prefetch" href="/demo/assets/js/4.d19479ad.js"><link rel="prefetch" href="/demo/assets/js/5.2781e97c.js"><link rel="prefetch" href="/demo/assets/js/6.a1681207.js"><link rel="prefetch" href="/demo/assets/js/7.57580baa.js"><link rel="prefetch" href="/demo/assets/js/8.2e0fdb35.js"><link rel="prefetch" href="/demo/assets/js/9.b6913332.js">
    <link rel="stylesheet" href="/demo/assets/css/0.styles.e35f60a0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/demo/" class="home-link router-link-active"><img src="/demo/assets/img/favicon.png" alt="对二甲苯" class="logo"> <span class="site-name can-hide">对二甲苯</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/demo/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识" class="dropdown-title"><span class="title">知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="知识" class="mobile-dropdown-title"><span class="title">知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/demo/js数组常用方法.html" class="nav-link">
  js数组常用方法
</a></li><li class="dropdown-item"><!----> <a href="/demo/CSS.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/demo/Vue项目目录中主要文件夹介绍.html" class="nav-link">
  Vue项目目录中主要文件夹介绍
</a></li><li class="dropdown-item"><!----> <a href="/demo/项目中的一些知识点.html" class="nav-link">
  项目中的一些知识点
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随笔" class="dropdown-title"><span class="title">随笔</span> <span class="arrow down"></span></button> <button type="button" aria-label="随笔" class="mobile-dropdown-title"><span class="title">随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/demo/随笔/写一篇.html" class="nav-link">
  写一篇
</a></li><li class="dropdown-item"><!----> <a href="/demo/随笔/写一篇2.html" class="nav-link">
  写一篇2
</a></li><li class="dropdown-item"><!----> <a href="/demo/随笔/威斯敏斯特教堂墓志铭.html" class="nav-link">
  威斯敏斯特教堂墓志铭
</a></li></ul></div></div><div class="nav-item"><a href="/demo/music/29414460.html" class="nav-link">
  音乐
</a></div><div class="nav-item"><a href="/demo/about.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/cpkang/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/demo/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识" class="dropdown-title"><span class="title">知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="知识" class="mobile-dropdown-title"><span class="title">知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/demo/js数组常用方法.html" class="nav-link">
  js数组常用方法
</a></li><li class="dropdown-item"><!----> <a href="/demo/CSS.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/demo/Vue项目目录中主要文件夹介绍.html" class="nav-link">
  Vue项目目录中主要文件夹介绍
</a></li><li class="dropdown-item"><!----> <a href="/demo/项目中的一些知识点.html" class="nav-link">
  项目中的一些知识点
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随笔" class="dropdown-title"><span class="title">随笔</span> <span class="arrow down"></span></button> <button type="button" aria-label="随笔" class="mobile-dropdown-title"><span class="title">随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/demo/随笔/写一篇.html" class="nav-link">
  写一篇
</a></li><li class="dropdown-item"><!----> <a href="/demo/随笔/写一篇2.html" class="nav-link">
  写一篇2
</a></li><li class="dropdown-item"><!----> <a href="/demo/随笔/威斯敏斯特教堂墓志铭.html" class="nav-link">
  威斯敏斯特教堂墓志铭
</a></li></ul></div></div><div class="nav-item"><a href="/demo/music/29414460.html" class="nav-link">
  音乐
</a></div><div class="nav-item"><a href="/demo/about.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/cpkang/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>项目中的一些知识点</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/demo/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9.html#一、关于vue-config-js" class="sidebar-link">一、关于vue.config.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/demo/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9.html#_1-publicpath" class="sidebar-link">1.publicPath</a></li><li class="sidebar-sub-header"><a href="/demo/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9.html#_2-outputdir" class="sidebar-link">2.outputDir</a></li><li class="sidebar-sub-header"><a href="/demo/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9.html#_3-assestdir" class="sidebar-link">3.assestDir</a></li><li class="sidebar-sub-header"><a href="/demo/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9.html#_4-lintonsave" class="sidebar-link">4.lintOnSave</a></li><li class="sidebar-sub-header"><a href="/demo/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9.html#_5-productionsourcemap" class="sidebar-link">5.productionSourceMap</a></li><li class="sidebar-sub-header"><a href="/demo/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9.html#_6-devserver" class="sidebar-link">6.devServer</a></li></ul></li><li><a href="/demo/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9.html#二、解读vue-element-admin登录逻辑permission-js" class="sidebar-link">二、解读vue-element-admin登录逻辑permission.js</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="项目中的一些知识点"><a href="#项目中的一些知识点" class="header-anchor">#</a> 项目中的一些知识点</h1> <h2 id="一、关于vue-config-js"><a href="#一、关于vue-config-js" class="header-anchor">#</a> 一、关于vue.config.js</h2> <p><code>vue.config.js</code> 是一个可选的配置文件，如果项目的根目录中存在这个文件，那么它会被 <code>@vue/cli-service</code> 自动加载。</p> <p>这个文件应该导出一个包含了选项的对象。</p> <h3 id="_1-publicpath"><a href="#_1-publicpath" class="header-anchor">#</a> 1.publicPath</h3> <ul><li><p>Type: <code>string</code></p></li> <li><p>Default: <code>'/'</code></p></li></ul> <p>​		部署应用包时的基本 URL。</p> <h3 id="_2-outputdir"><a href="#_2-outputdir" class="header-anchor">#</a> 2.outputDir</h3> <ul><li><p>Type: <code>string</code></p></li> <li><p>Default: <code>'dist'</code></p></li></ul> <p>​		当运行 <code>vue-cli-service build</code> 时生成的生产环境构建文件的目录。注意目标目录的内容在构建之前会被清除 (构建时传入 <code>--no-clean</code> 可关闭该行为)。</p> <h3 id="_3-assestdir"><a href="#_3-assestdir" class="header-anchor">#</a> 3.assestDir</h3> <ul><li><p>Type: <code>string</code></p></li> <li><p>Default: <code>''</code></p></li></ul> <p>​		放置生成的静态资源（js、css、img、font）的（相对于<code>outputDir</code>的）目录。</p> <h3 id="_4-lintonsave"><a href="#_4-lintonsave" class="header-anchor">#</a> 4.lintOnSave</h3> <ul><li>Type: <code>boolean</code> | <code>'warning'</code> | <code>'default'</code> | <code>'error'</code></li> <li>Default: <code>'default'</code></li></ul> <p>​		是否在开发环境下通过 <a href="https://github.com/webpack-contrib/eslint-loader" target="_blank" rel="noopener noreferrer">eslint-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 在每次保存时 lint 代码。</p> <h3 id="_5-productionsourcemap"><a href="#_5-productionsourcemap" class="header-anchor">#</a> 5.productionSourceMap</h3> <ul><li><p>Type: <code>boolean</code></p></li> <li><p>Default: <code>true</code></p> <p>如果你不需要生产环境的 source map , 可以将其设置为false以加速生产环境构建。设置之后就不会生成map文件。</p></li></ul> <h3 id="_6-devserver"><a href="#_6-devserver" class="header-anchor">#</a> 6.devServer</h3> <h4 id="_1-host"><a href="#_1-host" class="header-anchor">#</a> (1) host</h4> <ul><li>Type:<code>'local-ip' | 'local-ipv4' | 'local-ipv6'</code> <code>string</code></li></ul> <p>​		指定要使用的 host。如果你想让你的服务器可以被外部访问，像这样指定：</p> <p>​		<code>host: '0.0.0.0'</code></p> <h4 id="_2-port"><a href="#_2-port" class="header-anchor">#</a> (2) port</h4> <ul><li>Type:<code>'auto'</code> <code>string</code> <code>number</code></li></ul> <p>​		指定监听请求的端口号，例如：</p> <p>​		<code>port:10086</code></p> <h4 id="_3-proxy"><a href="#_3-proxy" class="header-anchor">#</a> (3) proxy</h4> <ul><li><p>Type: <code>string | Object</code></p> <p>如果你的前端应用和后端API服务器没有运行在同一个主机上，你需要在开发环境下将API请求代理到API服务器。这个问题可以通过<code>vue.config.js</code>中的<code>devServer.proxy</code>选项来配置。</p> <ul><li><p><code>devServer.proxy</code>可以是一个指向开发环境API服务器的字符串：</p> <p><code>proxy:'http://hocalhost:4000'</code></p> <p>这会告诉开发服务器将任何未知请求 (没有匹配到静态文件的请求) 代理到<code>http://hocalhost:4000</code>。</p></li> <li><p>如果你想要更多的代理控制行为，也可以使用一个<code>path:options</code>成对的对象。</p></li></ul></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'&lt;url&gt;'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token string-property property">'/foo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'&lt;other_url&gt;'</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>changeOrigin的值为true,意味着控制服务器接收到的请求头中host设置成target；值如果为false，host就是浏览器发送过来的host</p> <h4 id="_4-disablehostcheck"><a href="#_4-disablehostcheck" class="header-anchor">#</a> (4)disableHostCheck</h4> <p><strong>绕过主机检查</strong>。</p> <p>用于配置是否关闭用于 DNS 重绑定的 HTTP 请求的 HOST 检查。 DevServer 默认只接受来自本地的请求，关闭后可以接受来自任何 HOST 的请求。 它通常用于搭配--host 0.0.0.0使用，因为你想要其它设备访问你本地的服务，但访问时是直接通过 IP 地址访问而不是 HOST 访问，所以需要关闭 HOST 检查。</p> <hr> <p>参考文档：<a href="https://cli.vuejs.org/zh/config/#vue-config-js" target="_blank" rel="noopener noreferrer">vue.config.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="二、解读vue-element-admin登录逻辑permission-js"><a href="#二、解读vue-element-admin登录逻辑permission-js" class="header-anchor">#</a> 二、解读vue-element-admin登录逻辑permission.js</h2> <p><strong>vue-element-admin中，permission主要负责全局路由守卫和登录判断，希望通过以下注释说明，帮助大家理解这个文件的逻辑</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
<span class="token keyword">import</span> NProgress <span class="token keyword">from</span> <span class="token string">'nprogress'</span> 
<span class="token keyword">import</span> <span class="token string">'nprogress/nprogress.css'</span> 
<span class="token comment">//auth文件主要依赖js-cookie模块，把getToken，setToken，removeToken设置在这里</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span> 
<span class="token comment">//get-page-title文件主要是网站的标题，get-page-title通过依赖setting.js里的title变量修改网站标题</span>
<span class="token comment">//如果需要更改网站的标题，可以直接到setting.js修改title属性</span>
<span class="token keyword">import</span> getPageTitle <span class="token keyword">from</span> <span class="token string">'@/utils/get-page-title'</span>

<span class="token comment">//NProgress是封装的进度条，基本不用动</span>
NProgress<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">showSpinner</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> 

<span class="token comment">//路由白名单列表，把路由添加到这个数组，不用登陆也可以访问</span>
<span class="token keyword">const</span> whiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/login'</span><span class="token punctuation">]</span> 


router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  <span class="token comment">// 请求路由时进度条开始</span>
  NProgress<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 设置标题</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token function">getPageTitle</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title<span class="token punctuation">)</span>

  <span class="token comment">// 这里的getToken()就是在上面导入的auth.js里的getToken()方法</span>
  <span class="token keyword">const</span> hasToken <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//如果存在token，即存在已登陆的令牌</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//如果用户存在令牌的情况请求登录页面，就让用户直接跳转到首页，避免存在重复登录的情况</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 直接跳转到首页，当然取决于你的路由重定向到哪里</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">//一定要关闭进度条</span>
      NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//如果已经有令牌的用户请求的不是登录页，是其他页面</span>
      <span class="token comment">//就从Vuex里拿到用户的信息，这里也证明用户不是第一次登录了</span>
      <span class="token keyword">const</span> hasGetUserInfo <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>name
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasGetUserInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//信息拿到后，用户请求哪就跳转哪</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果有令牌，但是没有用户信息，证明用户是第一次登录，通过Vuex设置用户信息</span>
          <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/getInfo'</span><span class="token punctuation">)</span>
		<span class="token comment">//设置好了之后，依然可以请求哪就跳转哪</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果出错了，把令牌去掉，并让用户重新去到登录页面</span>
          <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/resetToken'</span><span class="token punctuation">)</span>
          Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error <span class="token operator">||</span> <span class="token string">'Has Error'</span><span class="token punctuation">)</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/login?redirect=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>to<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token comment">//关闭进度条</span>
          NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//这里是没有令牌的情况</span>
    <span class="token comment">//还记得上面的白名单吗，现在起作用了</span>
    <span class="token comment">//whiteList.indexOf(to.path) !== -1)判断用户请求的路由是否在白名单里</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>whiteList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 不是-1就证明存在白名单里，不管你有没有令牌，都直接去到白名单路由对应的页面</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果这个页面不在白名单里，直接跳转到登录页面</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/login?redirect=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>to<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token comment">//关闭进度条</span>
      NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//每次请求结束后都需要关闭进度条</span>
  NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>转载于CSDN</p> <p><a href="https://blog.csdn.net/weixin_43564110/article/details/105117991" target="_blank" rel="noopener noreferrer">原文出处<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>by HaooNAME</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/demo/assets/js/app.717f180f.js" defer></script><script src="/demo/assets/js/2.59a3a8ac.js" defer></script><script src="/demo/assets/js/18.3836db53.js" defer></script>
  </body>
</html>
